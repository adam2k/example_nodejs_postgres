version: '1.0'
steps:
    build_step:
      type: build
      image_name: codefreshio/yaml-example-unit-test-compose
      dockerfile: Dockerfile
      tag: ${{CF_BRANCH}}

    unit_test:
      type: composition
      working_directory: ${{main_clone}}
      composition:
        version: '2'
        services:
          postgres:
            image: postgres:latest
            environment:
              - POSTGRES_USER=user
              - POSTGRES_PASSWORD=admin
              - POSTGRES_DB=todo
      composition_candidates:
        test:
          image: ${{build_step}}
          links:
            - postgres
          command: bash -c 'sleep 30 && npm test'